#include <stdio.h>
#include <stdlib.h>
#include <dirent.h>
#include <string.h>
#include <getopt.h>
#include "read.h"
#include "copy.h"


void ReadRecursive(const char* _pathname, char _pass){
	DIR *folder;
	struct dirent* file;

	if (_pass || ReadInfo(_pathname)){//Note in a 'or' if first valid, second never tested
		folder = opendir(_pathname);
		
		while ((file = readdir(folder)))
		{
			char NewPathname[100];
			strncpy(NewPathname,_pathname,100);
			if ((_pathname[strnlen(_pathname,100)-1]) != '/'){
				strncat(NewPathname,"/",2);
			}
			strncat(NewPathname,file->d_name,100);
			if (file->d_name[0] != '.' || (file->d_name[1] != '.' && file->d_name[1] != '\0')){//Bloc '.' and '..' directories
				if (ReadInfo(NewPathname)){
					ReadRecursive(NewPathname, 1);
				}
			}
		}

		closedir(folder);
	}

}

void PrintHelp(){

}

int main(int argc, char const *argv[])
{
	if (argc == 1)
		PrintHelp();
	if (argc == 2)
		ReadRecursive(argv[1],0);
	if (0){
		if (FileCopy(argv[1],argv[2]) == -1){
			fprintf(stderr,"\t%s\n",argv[0]);
			exit(EXIT_FAILURE);
		}
	}
	if (argc == 3){
		if ( DirCopy(argv[1],argv[2]) == -1 ){
			fprintf(stderr,"\t%s\n",argv[0]);
			exit(EXIT_FAILURE);
		}
	}
	return 0;
}
