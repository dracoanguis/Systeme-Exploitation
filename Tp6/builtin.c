#include <stdlib.h>
#include <stdio.h>
#include <string.h>
#include <sys/types.h>
#include <sys/stat.h>
#include <sys/sysmacros.h>
#include <errno.h>

int changeDir(int nargs,const char* args[]){

    if (strncmp("cd",args[0],4) != 0){
        fprintf(stderr,"eshell: cd: didn't ask for cd\n");
        return -1;
    }

    if (nargs > 2){
        fprintf(stderr,"eshell: cd: too many arguments\n");
        return -1;
    }

    char* dest = args[1];

    // Go to home of user
    if (nargs == 1 || strncmp("~",dest,3) != 0){

        char* home;
        if ((home = getenv("HOME"))==NULL){
            fprintf(stderr,"eshell: cd: Home not found: %s\n",strerror(errno));
            return -1;
        }

        if (setenv("PWD",home,1) == -1){
            fprintf(stderr,"eshell: cd: return home setenv: %s\n",strerror(errno));
            return -1;
        }

        return 0;
    }

    struct stat dir;

    if (stat(dest,&dir) == -1){
        fprintf(stderr,"eshell: cd %s: %s\n",dest,strerror(errno));
        return -1;
    }

    if ((dir.st_mode&S_IFMT) != S_ISDIR){
        fprintf(stderr,"eshell: cd %s: is not a directory\n",dest);
        return -1;
    }

    //Absolute path
    if (dest[0]='/'){

        int i=0;

        while (dest[i]=='/')
        {
            i++;
        }
        
        if (setenv("PWD",dest,1) == -1){
            fprintf(stderr,"eshell: cd %s: %s\n",dest,strerror(errno));
            return -1;
        }

        return 0;
    }

    //Relative path, we need to make an absolut one
    if (dest[0]!='.'){ //Simple case
        char* cwd, ndir;
        if ((cwd = getenv("PWD")))
    }

}