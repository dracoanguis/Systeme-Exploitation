#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include <errno.h>


char* getLine(){
    char* buffer = calloc(1024,sizeof(char));

    if (buffer == NULL){
        fprintf(stderr,"eshell: getLine: %s\n",strerror(errno));
        return NULL;
    }

    //fflush(stdin); undefined result by C standard

    char c;
    int nChar=0, mChar = 1024;

    while((c=(char)fgetc(stdin)) != EOF && c != '\n'){
        if (nChar >= mChar){
            if ((buffer = realloc(buffer,(mChar+1024)*sizeof(char)))){
                fprintf(stderr,"eshell: getLine: %s\n",strerror(errno));
                return NULL;
            }
        }

        buffer[nChar] = c;
        nChar++;
    }

    buffer[nChar] = '\0';
    
    return buffer;
}

char** getArgv(char line[]){
    
    if (line == NULL){
        fprintf(stderr,"eshell: getArgv: input error\n");
        return NULL;
    }

    char delimiters[] = " \t\n\v\f\r";
    char** toks;

    if ((toks = calloc(64,sizeof(char*))) == NULL){
        fprintf(stderr,"eshell: getArgv: %s\n",strerror(errno));
        return NULL;
    } 

    int nToks = 0, mToks = 64;
    char* curtok = strtok(line,delimiters);

    while (curtok != NULL)
    {
        if (nToks >= mToks){
            if ((toks = realloc(toks,(mToks+64)*sizeof(char*))) == NULL){
                fprintf(stderr,"eshell: getArgv: %s\n",strerror(errno));
                return NULL;
            }
            mToks += 64;
        }

        toks[nToks] = curtok;
        nToks++;
        curtok = strtok(NULL,delimiters);
    }
    
    //To know where it ends
    toks[nToks++] = NULL;

    return toks;
}

int getArgc(const char* argv[]){
    
    int argc=0;
    while(argv[argc])
        argc++;

    return argc;
}
